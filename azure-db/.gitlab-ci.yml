.change_rules_azure_db:
  rules:
    - if: '$CI_COMMIT_BRANCH == "master"'
    - &changes_azure_db
      changes:
        - .gitlab-ci.yml
        - azure-db/**/*

Lint azure-db:
  stage: "Quality"
  extends: .change_rules_azure_db
  image: hadolint/hadolint:v1.23.0-debian
  script:
    - hadolint ./azure-db/Dockerfile

Build azure-db:
  stage: "Build"
  needs:
    - Lint azure-db
  extends:
    - .base_register_to_gitlab_stage
    - .change_rules_azure_db
  variables:
    CONTEXT: azure-db
    IMAGE_NAME: ${CI_REGISTRY_IMAGE}/azure-db

Publish azure-db to Github Registry:
  extends: .base_publish_to_github_stage
  rules:
    - <<: *changes_azure_db
      if: "$CI_COMMIT_TAG"
  needs:
    - Lint azure-db
    - Build azure-db
    - Test azure-db 1 3
    - Test azure-db 2 3
    - Test azure-db 3 3
  variables:
    IMAGE_NAME: socialgouv/docker/azure-db
